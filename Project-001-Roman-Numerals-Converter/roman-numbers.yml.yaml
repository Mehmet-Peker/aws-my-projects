AWSTemplateFormatVersion: 2010-09-09
Description: |
  AWS CloudFormation Sample Template EC2InstanceWithSecurityGroupSample: Create
  an Amazon EC2 instance running the Amazon Linux AMI. The AMI is chosen based
  on the region in which the stack is run. This example creates an EC2 security
  group for the instance to give you SSH access. **WARNING** This template
  creates an Amazon EC2 instance. You will be billed for the AWS resources used
  if you create a stack from this template.
  
Parameters:
  myKeyPair:
    Description: Select your keypair
    Type: AWS::EC2::KeyPair::KeyName
  
Resources:
  mySecGrp:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: Security Group for HTTP and SSH # Required
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 22 
          ToPort: 22
          CidrIp: 0.0.0.0/0
        - IpProtocol: tcp
          FromPort: 80 
          ToPort: 80
          CidrIp: 0.0.0.0/0

  myEC2Instance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: ami-05fa00d4c63e32376
      InstanceType: t2.micro
      KeyName: !Ref myKeyPair 
      SecurityGroupIds:
        - !Ref mySecGrp 
      Tags:
        - Key: Name
          Value: !Sub Web Server of ${AWS::StackName} 
      UserData: 
        Fn::Base64: |
            #! /bin/bash
            yum update -y
            sudo pip3 install flask 
            sudo yum install git -y
            sudo mkdir /home/ec2-user/myProject && cd /home/ec2-user/myProject
            sudo git clone https://github.com/Mehmet-Peker/test.git
            cd /home/ec2-user/myProject/test 
            sudo python3 app.py
Outputs:
 myURL:
  Value: !GetAtt myEC2Instance.PublicDnsName 